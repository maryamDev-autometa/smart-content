<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Content Strategy Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .health-score {
            grid-column: span 2;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            position: relative;
            background: conic-gradient(
                #e74c3c 0deg,
                #f39c12 72deg,
                #f1c40f 144deg,
                #2ecc71 216deg,
                #27ae60 360deg
            );
        }

        .score-inner {
            width: 130px;
            height: 130px;
            background: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .score-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #2c3e50;
        }

        .score-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .breakdown-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .breakdown-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .breakdown-score {
            font-size: 1.5em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }

        .breakdown-label {
            font-size: 0.85em;
            color: #7f8c8d;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #7f8c8d;
        }

        .metric-value {
            font-weight: bold;
            color: #2c3e50;
        }

        .trend-positive {
            color: #27ae60;
        }

        .trend-negative {
            color: #e74c3c;
        }

        .recommendations {
            list-style: none;
        }

        .recommendations li {
            padding: 10px 0;
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 0 5px 5px 0;
        }

        .topic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .topic-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .topic-category {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .topic-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .topic-reason {
            font-size: 0.8em;
            opacity: 0.8;
        }

        .competitor-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .competitor-name {
            font-weight: bold;
            color: #2c3e50;
        }

        .competitor-score {
            background: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
        }

        .schedule-day {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 8px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .error {
            background: #ffe6e6;
            color: #c0392b;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .success {
            background: #e8f5e8;
            color: #27ae60;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .controls {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .input-group {
            display: flex;
            gap: 15px;
            align-items: end;
            flex-wrap: wrap;
        }

        .input-field {
            flex: 1;
            min-width: 200px;
        }

        .input-field label {
            display: block;
            margin-bottom: 5px;
            color: #2c3e50;
            font-weight: 500;
        }

        .input-field input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .input-field input:focus {
            outline: none;
            border-color: #667eea;
        }

        @media (max-width: 768px) {
            .health-score {
                grid-column: span 1;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .input-field {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <!-- <h1>Smart Content Strategy Dashboard</h1> -->
             <h1>Dashboard</h1>
            <p>Data-backed insights for YouTube content creators</p>
        </div>

        <div class="controls">
            <div class="input-group">
                <div class="input-field">
                    <label for="channelId">YouTube Channel ID</label>
                    <input type="text" id="channelId" placeholder="Enter channel ID or handle">
                </div>
                <div class="input-field">
                    <label for="channelName">Channel/Business Name</label>
                    <input type="text" id="channelName" placeholder="Enter business name">
                </div>
                <div class="input-field">
                    <label for="channelDomain">Website Domain (optional)</label>
                    <input type="text" id="channelDomain" placeholder="example.com">
                </div>
                <button class="btn" onclick="analyzeChannel()">Analyze Channel</button>
                <button class="btn" onclick="exportReport()">Export Report</button>
            </div>
        </div>

        <div id="dashboard-content">
            <div class="loading">
                <!-- <h3>Welcome to Smart Content Strategy Dashboard</h3> -->
                 <h3>Welcome</h3>
                <p>Enter your channel information above to get started with AI-powered content insights.</p>
            </div>
        </div>
    </div>

    <script>
        let currentAnalysis = null;

        function showLoading(message = 'Analyzing your channel...') {
            document.getElementById('dashboard-content').innerHTML = `
                <div class="loading">
                    <h3>${message}</h3>
                    <p>This may take a few moments as we gather data from YouTube and market intelligence sources.</p>
                </div>
            `;
        }

        function showError(message) {
            document.getElementById('dashboard-content').innerHTML = `
                <div class="error">
                    <h3>Error</h3>
                    <p>${message}</p>
                </div>
            `;
        }

        function showSuccess(message) {
            const content = document.getElementById('dashboard-content');
            content.insertAdjacentHTML('afterbegin', `
                <div class="success">
                    ${message}
                </div>
            `);
            setTimeout(() => {
                const successEl = content.querySelector('.success');
                if (successEl) successEl.remove();
            }, 3000);
        }

        async function analyzeChannel() {
            const channelId = document.getElementById('channelId').value.trim();
            const channelName = document.getElementById('channelName').value.trim();
            const channelDomain = document.getElementById('channelDomain').value.trim();

            if (!channelId && !channelName) {
                showError('Please enter either a Channel ID or Business Name');
                return;
            }

            showLoading();

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        channelId,
                        channelName,
                        channelDomain
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const analysis = await response.json();
                currentAnalysis = analysis;
                renderDashboard(analysis);
                
            } catch (error) {
                console.error('Analysis error:', error);
                showError('Failed to analyze channel. Please check your inputs and try again.');
            }
        }

        function renderDashboard(analysis) {
            const content = `
                <div class="grid">
                    <div class="card health-score">
                        <h3>Channel Health Score</h3>
                        <div class="score-circle">
                            <div class="score-inner">
                                <div class="score-number">${analysis.channelHealthScore.overall}</div>
                                <div class="score-label">Overall</div>
                            </div>
                        </div>
                        <div class="breakdown-grid">
                            <div class="breakdown-item">
                                <div class="breakdown-score">${analysis.channelHealthScore.breakdown.engagement}</div>
                                <div class="breakdown-label">Engagement</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-score">${analysis.channelHealthScore.breakdown.consistency}</div>
                                <div class="breakdown-label">Consistency</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-score">${analysis.channelHealthScore.breakdown.growth}</div>
                                <div class="breakdown-label">Growth</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-score">${analysis.channelHealthScore.breakdown.marketAlignment}</div>
                                <div class="breakdown-label">Market Fit</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-score">${analysis.channelHealthScore.breakdown.contentQuality}</div>
                                <div class="breakdown-label">Quality</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Key Metrics</h3>
                        <div class="metric">
                            <span class="metric-label">Subscribers</span>
                            <span class="metric-value">${formatNumber(analysis.youtubeData?.statistics?.subscriberCount || 0)}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Total Views</span>
                            <span class="metric-value">${formatNumber(analysis.youtubeData?.statistics?.viewCount || 0)}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Video Count</span>
                            <span class="metric-value">${formatNumber(analysis.youtubeData?.statistics?.videoCount || 0)}</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Avg. Engagement</span>
                            <span class="metric-value">${calculateAvgEngagement(analysis.youtubeData?.topVideos || [])}%</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Recommended Actions</h3>
                        <ul class="recommendations">
                            ${analysis.channelHealthScore.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                </div>

                <div class="grid">
                    <div class="card">
                        <h3>Trending Topics for Your Next Videos</h3>
                        <div class="topic-grid">
                            ${analysis.contentRecommendations.topics.slice(0, 6).map(topic => `
                                <div class="topic-item">
                                    <div class="topic-category">${topic.category}</div>
                                    <div class="topic-title">${topic.topics[0] || 'New Topic'}</div>
                                    <div class="topic-reason">${topic.reason}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="card">
                        <h3>Competitor Analysis</h3>
                        ${analysis.competitorAnalysis.topCompetitors ? 
                            analysis.competitorAnalysis.topCompetitors.map(comp => `
                                <div class="competitor-item">
                                    <div>
                                        <div class="competitor-name">${comp.name}</div>
                                        <div style="font-size: 0.9em; color: #7f8c8d;">${comp.size} employees</div>
                                    </div>
                                    <div class="competitor-score">${comp.competitorScore || 75}</div>
                                </div>
                            `).join('') : '<p>No competitor data available</p>'
                        }
                    </div>

                    <div class="card">
                        <h3>Recommended Upload Schedule</h3>
                        <div style="margin-bottom: 15px;">
                            <strong>Frequency:</strong> ${analysis.uploadSchedule.frequency}
                        </div>
                        ${Object.entries(analysis.uploadSchedule.weeklySchedule || {}).map(([day, time]) => `
                            <div class="schedule-day">
                                <span>${day}</span>
                                <span style="color: #667eea; font-weight: bold;">${time}</span>
                            </div>
                        `).join('')}
                        <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 0.9em;">
                            <strong>Optimal Times:</strong> ${analysis.uploadSchedule.optimalTimes.join(', ')}
                        </div>
                    </div>

                    <div class="card">
                        <h3>Growth Opportunities</h3>
                        ${analysis.growthOpportunities.map(opp => `
                            <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                                <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">${opp.type}</div>
                                <div style="color: #7f8c8d; margin-bottom: 5px;">${opp.description}</div>
                                <div style="font-size: 0.9em;">
                                    <span style="color: #27ae60;">Potential: ${opp.potential}</span> • 
                                    <span style="color: #3498db;">Timeline: ${opp.timeline}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                ${analysis.contentTrends ? `
                <div class="grid">
                    <div class="card">
                        <h3>🔥 Rising Content Analysis</h3>
                        <p style="margin-bottom: 15px; color: #7f8c8d;">Content with increasing momentum and why it's performing well</p>
                        ${analysis.contentTrends.risingContent && analysis.contentTrends.risingContent.length > 0 ? 
                            analysis.contentTrends.risingContent.slice(0, 3).map(content => `
                                <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid ${getTrendColor(content.status)};">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <div style="font-weight: bold; color: #2c3e50;">${content.title}</div>
                                        <div style="background: ${getTrendColor(content.status)}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8em; text-transform: uppercase;">
                                            ${content.status}
                                        </div>
                                    </div>
                                    <div style="margin-bottom: 10px;">
                                        <strong>Performance Score:</strong> ${content.performanceScore}/100 • 
                                        <strong>Hours Old:</strong> ${content.hoursOld}
                                    </div>
                                    <div style="margin-bottom: 10px;">
                                        <strong>Why it's rising:</strong>
                                        <ul style="margin: 5px 0 0 20px; font-size: 0.9em;">
                                            ${content.trendReasons.slice(0, 2).map(reason => `
                                                <li><span style="color: ${getImpactColor(reason.impact)};">●</span> ${reason.description}</li>
                                            `).join('')}
                                        </ul>
                                    </div>
                                    ${content.projectedPeak ? `
                                        <div style="font-size: 0.9em; color: #7f8c8d;">
                                            <strong>Projected Peak:</strong> ${formatNumber(content.projectedPeak.estimatedPeakViews)} views in ${content.projectedPeak.estimatedPeakTimeHours}h
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('') : '<p>No rising content detected in the analysis window</p>'
                        }
                    </div>

                    <div class="card">
                        <h3>📈 Trending Patterns & Insights</h3>
                        ${analysis.contentTrends.trendingReasons ? `
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #2c3e50; margin-bottom: 10px;">Top Success Factors</h4>
                                ${analysis.contentTrends.trendingReasons.topReasons.map(reason => `
                                    <div style="display: flex; justify-content: space-between; padding: 8px 12px; background: #f8f9fa; border-radius: 5px; margin-bottom: 5px;">
                                        <span>${reason.reason}</span>
                                        <span style="background: #3498db; color: white; padding: 2px 6px; border-radius: 10px; font-size: 0.8em;">${reason.frequency}</span>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #2c3e50; margin-bottom: 10px;">Market Pattern</h4>
                                <div style="padding: 12px; background: #e8f5e8; border-radius: 8px; border-left: 4px solid #27ae60;">
                                    ${analysis.contentTrends.trendingReasons.overallPattern}
                                </div>
                            </div>

                            ${analysis.contentTrends.trendingReasons.marketInsights && analysis.contentTrends.trendingReasons.marketInsights.length > 0 ? `
                                <div>
                                    <h4 style="color: #2c3e50; margin-bottom: 10px;">Strategic Insights</h4>
                                    ${analysis.contentTrends.trendingReasons.marketInsights.map(insight => `
                                        <div style="margin-bottom: 15px; padding: 12px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                                            <div style="font-weight: bold; margin-bottom: 5px;">${insight.insight}</div>
                                            <div style="color: #856404; font-size: 0.9em;">${insight.action}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        ` : '<p>Analyzing trending patterns...</p>'}
                    </div>

                    <div class="card">
                        <h3>🚀 Content Opportunities</h3>
                        ${analysis.contentTrends.contentOpportunities && analysis.contentTrends.contentOpportunities.length > 0 ? 
                            analysis.contentTrends.contentOpportunities.map(opp => `
                                <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 8px;">
                                        <div style="font-weight: bold; color: #2c3e50;">${opp.type}</div>
                                        <div style="background: ${getPriorityColor(opp.priority)}; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.8em;">
                                            ${opp.priority}
                                        </div>
                                    </div>
                                    <div style="color: #7f8c8d; margin-bottom: 8px;">${opp.reason}</div>
                                    ${opp.suggestedTopics ? `
                                        <div style="font-size: 0.9em;">
                                            <strong>Suggested Topics:</strong> ${opp.suggestedTopics.join(', ')}
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('') : '<p>Analyzing content opportunities...</p>'
                        }
                    </div>

                    ${analysis.contentTrends.viralPotential && analysis.contentTrends.viralPotential.length > 0 ? `
                        <div class="card">
                            <h3>⚡ Viral Potential Analysis</h3>
                            ${analysis.contentTrends.viralPotential.map(candidate => `
                                <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #e74c3c;">
                                    <div style="font-weight: bold; margin-bottom: 8px;">${candidate.title}</div>
                                    <div style="margin-bottom: 8px;">
                                        <strong>Viral Score:</strong> ${candidate.viralScore}/100
                                    </div>
                                    <div style="margin-bottom: 8px;">
                                        <strong>Viral Factors:</strong>
                                        <ul style="margin: 5px 0 0 20px; font-size: 0.9em;">
                                            ${candidate.viralFactors.map(factor => `<li>${factor}</li>`).join('')}
                                        </ul>
                                    </div>
                                    <div style="font-style: italic; color: #7f8c8d;">${candidate.recommendation}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
                ` : ''}
            `;

            document.getElementById('dashboard-content').innerHTML = content;
        }

        function getTrendColor(status) {
            const colors = {
                'viral': '#e74c3c',
                'trending': '#f39c12', 
                'rising': '#27ae60',
                'stable': '#3498db',
                'declining': '#95a5a6'
            };
            return colors[status] || '#95a5a6';
        }

        function getImpactColor(impact) {
            const colors = {
                'High': '#e74c3c',
                'Medium': '#f39c12',
                'Low': '#27ae60'
            };
            return colors[impact] || '#95a5a6';
        }

        function getPriorityColor(priority) {
            const colors = {
                'Immediate': '#e74c3c',
                'High': '#f39c12',
                'Medium': '#3498db',
                'Low': '#95a5a6'
            };
            return colors[priority] || '#95a5a6';
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        function calculateAvgEngagement(videos) {
            if (!videos || videos.length === 0) return '0.0';
            
            const totalEngagement = videos.reduce((sum, video) => {
                const views = parseInt(video.viewCount) || 0;
                const likes = parseInt(video.likeCount) || 0;
                const comments = parseInt(video.commentCount) || 0;
                
                if (views === 0) return sum;
                return sum + ((likes + comments) / views) * 100;
            }, 0);

            return (totalEngagement / videos.length).toFixed(1);
        }

        async function exportReport() {
            if (!currentAnalysis) {
                showError('Please analyze a channel first before exporting');
                return;
            }

            try {
                const response = await fetch('/api/export', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(currentAnalysis)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'content-strategy-report.md';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);

                showSuccess('Report exported successfully!');
                
            } catch (error) {
                console.error('Export error:', error);
                showError('Failed to export report. Please try again.');
            }
        }

        // Demo data for testing
        function loadDemoData() {
            document.getElementById('channelId').value = 'UC_x5XG1OV2P6uZZ5FSM9Ttw';
            document.getElementById('channelName').value = 'Google for Developers';
            document.getElementById('channelDomain').value = 'developers.google.com';
        }

        // Add demo button for testing
        document.addEventListener('DOMContentLoaded', function() {
            const controls = document.querySelector('.input-group');
            const demoBtn = document.createElement('button');
            demoBtn.className = 'btn';
            demoBtn.textContent = 'Load Demo';
            demoBtn.style.background = '#95a5a6';
            demoBtn.onclick = loadDemoData;
            controls.appendChild(demoBtn);
        });
    </script>
</body>
</html>